version: '3.8'
services:
  sut:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "41641:41641/udp"
      - "41641:41641/tcp"
    volumes:
      - data:/data
    environment:
      - NODETYPE=edge
      - TSKEY=""
      - TSAPIKEY=""
      - AWS_ACCESS_KEY_ID=""
      - AWS_SECRET_ACCESS_KEY=""
      - AWS_DEFAULT_REGION="us-west-2"
      - AWS_S3_BUCKET="cluster-anywhere"
    mem_limit: 5.6gb
    ulimits:
      memlock:
        soft: -1
        hard: -1
    devices:
      - "/dev/net/tun:/dev/net/tun"
    cap_add:
      - NET_ADMIN
      - SYS_PTRACE
      - SYS_ADMIN
    healthcheck:
      test: ["CMD", "sh", "/home/ray/run_tests.sh"]
      interval: 150s
      timeout: 30s
      start_period: 300s
      retries: 1

volumes:
  data:
