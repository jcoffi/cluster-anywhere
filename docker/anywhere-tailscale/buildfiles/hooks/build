#!/bin/bash
export NUMEXPR_MAX_THREADS='$(nproc)'
#used by conda to specify cpus for building packages
export MAKEFLAGS='-j$(nproc)'
#used by conda
export CPU_COUNT='$(nproc)'
# Set image type based on build argument
docker buildx build . \
--cache-to=jcoffi/cluster-anywhere:$DOCKER_TAG-cache \
--cache-from=jcoffi/cluster-anywhere:$DOCKER_TAG-cache \
--ulimit 'memlock=-1' 'nofile=65535:65535' \
-t jcoffi/cluster-anywhere:$DOCKER_TAG \
--build-arg IMAGETYPE=$DOCKER_TAG