#!/bin/bash

# Set image type based on build argument
if [ $DOCKER_TAG = "cpu" ]; then
    docker build . --shm-size=6g --ulimit memlock=-1 --cache-from rayproject/ray:2.2.0-py38-cpu -t jcoffi/cluster-anywhere:cpu --build-arg IMAGETYPE=cpu
elif [ $DOCKER_TAG = "gpu" ]; then
    docker build . --shm-size=6g --ulimit memlock=-1 --cache-from jcoffi/cluster-anywhere:cpu -t jcoffi/cluster-anywhere:gpu --build-arg IMAGETYPE=gpu
else
    docker build . --shm-size=6g --ulimit memlock=-1 --cache-from jcoffi/cluster-anywhere:cpu -t jcoffi/cluster-anywhere:$DOCKER_TAG --build-arg IMAGETYPE=$DOCKER_TAG
fi
